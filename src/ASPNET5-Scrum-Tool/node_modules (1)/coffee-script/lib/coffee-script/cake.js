// Generated by CoffeeScript 1.10.0
(function() ***REMOVED***
  var CoffeeScript, cakefileDirectory, fatalError, fs, helpers, missingTask, oparse, options, optparse, path, printTasks, switches, tasks;

  fs = require('fs');

  path = require('path');

  helpers = require('./helpers');

  optparse = require('./optparse');

  CoffeeScript = require('./coffee-script');

  CoffeeScript.register();

  tasks = ***REMOVED******REMOVED***;

  options = ***REMOVED******REMOVED***;

  switches = [];

  oparse = null;

  helpers.extend(global, ***REMOVED***
    task: function(name, description, action) ***REMOVED***
      var ref;
      if (!action) ***REMOVED***
        ref = [description, action], action = ref[0], description = ref[1];
  ***REMOVED***
      return tasks[name] = ***REMOVED***
        name: name,
        description: description,
        action: action
  ***REMOVED***;
***REMOVED***,
    option: function(letter, flag, description) ***REMOVED***
      return switches.push([letter, flag, description]);
***REMOVED***,
    invoke: function(name) ***REMOVED***
      if (!tasks[name]) ***REMOVED***
        missingTask(name);
  ***REMOVED***
      return tasks[name].action(options);
***REMOVED***
  ***REMOVED***);

  exports.run = function() ***REMOVED***
    var arg, args, e, error, i, len, ref, results;
    global.__originalDirname = fs.realpathSync('.');
    process.chdir(cakefileDirectory(__originalDirname));
    args = process.argv.slice(2);
    CoffeeScript.run(fs.readFileSync('Cakefile').toString(), ***REMOVED***
      filename: 'Cakefile'
***REMOVED***);
    oparse = new optparse.OptionParser(switches);
    if (!args.length) ***REMOVED***
      return printTasks();
***REMOVED***
    try ***REMOVED***
      options = oparse.parse(args);
***REMOVED*** catch (error) ***REMOVED***
      e = error;
      return fatalError("" + e);
***REMOVED***
    ref = options["arguments"];
    results = [];
    for (i = 0, len = ref.length; i < len; i++) ***REMOVED***
      arg = ref[i];
      results.push(invoke(arg));
***REMOVED***
    return results;
  ***REMOVED***;

  printTasks = function() ***REMOVED***
    var cakefilePath, desc, name, relative, spaces, task;
    relative = path.relative || path.resolve;
    cakefilePath = path.join(relative(__originalDirname, process.cwd()), 'Cakefile');
    console.log(cakefilePath + " defines the following tasks:\n");
    for (name in tasks) ***REMOVED***
      task = tasks[name];
      spaces = 20 - name.length;
      spaces = spaces > 0 ? Array(spaces + 1).join(' ') : '';
      desc = task.description ? "# " + task.description : '';
      console.log("cake " + name + spaces + " " + desc);
***REMOVED***
    if (switches.length) ***REMOVED***
      return console.log(oparse.help());
***REMOVED***
  ***REMOVED***;

  fatalError = function(message) ***REMOVED***
    console.error(message + '\n');
    console.log('To see a list of all tasks/options, run "cake"');
    return process.exit(1);
  ***REMOVED***;

  missingTask = function(task) ***REMOVED***
    return fatalError("No such task: " + task);
  ***REMOVED***;

  cakefileDirectory = function(dir) ***REMOVED***
    var parent;
    if (fs.existsSync(path.join(dir, 'Cakefile'))) ***REMOVED***
      return dir;
***REMOVED***
    parent = path.normalize(path.join(dir, '..'));
    if (parent !== dir) ***REMOVED***
      return cakefileDirectory(parent);
***REMOVED***
    throw new Error("Cakefile not found in " + (process.cwd()));
  ***REMOVED***;

***REMOVED***).call(this);
