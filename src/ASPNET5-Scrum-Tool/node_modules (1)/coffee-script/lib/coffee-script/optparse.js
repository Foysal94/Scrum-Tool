// Generated by CoffeeScript 1.10.0
(function() ***REMOVED***
  var LONG_FLAG, MULTI_FLAG, OPTIONAL, OptionParser, SHORT_FLAG, buildRule, buildRules, normalizeArguments, repeat;

  repeat = require('./helpers').repeat;

  exports.OptionParser = OptionParser = (function() ***REMOVED***
    function OptionParser(rules, banner) ***REMOVED***
      this.banner = banner;
      this.rules = buildRules(rules);
***REMOVED***

    OptionParser.prototype.parse = function(args) ***REMOVED***
      var arg, i, isOption, j, k, len, len1, matchedRule, options, originalArgs, pos, ref, rule, seenNonOptionArg, skippingArgument, value;
      options = ***REMOVED***
        "arguments": []
  ***REMOVED***;
      skippingArgument = false;
      originalArgs = args;
      args = normalizeArguments(args);
      for (i = j = 0, len = args.length; j < len; i = ++j) ***REMOVED***
        arg = args[i];
        if (skippingArgument) ***REMOVED***
          skippingArgument = false;
          continue;
***REMOVED***
        if (arg === '--') ***REMOVED***
          pos = originalArgs.indexOf('--');
          options["arguments"] = options["arguments"].concat(originalArgs.slice(pos + 1));
          break;
***REMOVED***
        isOption = !!(arg.match(LONG_FLAG) || arg.match(SHORT_FLAG));
        seenNonOptionArg = options["arguments"].length > 0;
        if (!seenNonOptionArg) ***REMOVED***
          matchedRule = false;
          ref = this.rules;
          for (k = 0, len1 = ref.length; k < len1; k++) ***REMOVED***
            rule = ref[k];
            if (rule.shortFlag === arg || rule.longFlag === arg) ***REMOVED***
              value = true;
              if (rule.hasArgument) ***REMOVED***
                skippingArgument = true;
                value = args[i + 1];
  ***REMOVED***
              options[rule.name] = rule.isList ? (options[rule.name] || []).concat(value) : value;
              matchedRule = true;
              break;
***REMOVED***
  ***REMOVED***
          if (isOption && !matchedRule) ***REMOVED***
            throw new Error("unrecognized option: " + arg);
  ***REMOVED***
***REMOVED***
        if (seenNonOptionArg || !isOption) ***REMOVED***
          options["arguments"].push(arg);
***REMOVED***
  ***REMOVED***
      return options;
***REMOVED***;

    OptionParser.prototype.help = function() ***REMOVED***
      var j, len, letPart, lines, ref, rule, spaces;
      lines = [];
      if (this.banner) ***REMOVED***
        lines.unshift(this.banner + "\n");
  ***REMOVED***
      ref = this.rules;
      for (j = 0, len = ref.length; j < len; j++) ***REMOVED***
        rule = ref[j];
        spaces = 15 - rule.longFlag.length;
        spaces = spaces > 0 ? repeat(' ', spaces) : '';
        letPart = rule.shortFlag ? rule.shortFlag + ', ' : '    ';
        lines.push('  ' + letPart + rule.longFlag + spaces + rule.description);
  ***REMOVED***
      return "\n" + (lines.join('\n')) + "\n";
***REMOVED***;

    return OptionParser;

  ***REMOVED***)();

  LONG_FLAG = /^(--\w[\w\-]*)/;

  SHORT_FLAG = /^(-\w)$/;

  MULTI_FLAG = /^-(\w***REMOVED***2,***REMOVED***)/;

  OPTIONAL = /\[(\w+(\*?))\]/;

  buildRules = function(rules) ***REMOVED***
    var j, len, results, tuple;
    results = [];
    for (j = 0, len = rules.length; j < len; j++) ***REMOVED***
      tuple = rules[j];
      if (tuple.length < 3) ***REMOVED***
        tuple.unshift(null);
  ***REMOVED***
      results.push(buildRule.apply(null, tuple));
***REMOVED***
    return results;
  ***REMOVED***;

  buildRule = function(shortFlag, longFlag, description, options) ***REMOVED***
    var match;
    if (options == null) ***REMOVED***
      options = ***REMOVED******REMOVED***;
***REMOVED***
    match = longFlag.match(OPTIONAL);
    longFlag = longFlag.match(LONG_FLAG)[1];
    return ***REMOVED***
      name: longFlag.substr(2),
      shortFlag: shortFlag,
      longFlag: longFlag,
      description: description,
      hasArgument: !!(match && match[1]),
      isList: !!(match && match[2])
***REMOVED***;
  ***REMOVED***;

  normalizeArguments = function(args) ***REMOVED***
    var arg, j, k, l, len, len1, match, ref, result;
    args = args.slice(0);
    result = [];
    for (j = 0, len = args.length; j < len; j++) ***REMOVED***
      arg = args[j];
      if (match = arg.match(MULTI_FLAG)) ***REMOVED***
        ref = match[1].split('');
        for (k = 0, len1 = ref.length; k < len1; k++) ***REMOVED***
          l = ref[k];
          result.push('-' + l);
***REMOVED***
  ***REMOVED*** else ***REMOVED***
        result.push(arg);
  ***REMOVED***
***REMOVED***
    return result;
  ***REMOVED***;

***REMOVED***).call(this);
