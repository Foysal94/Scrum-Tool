var path = require('path')
  , log = require('npmlog')

function findNodeDirectory(scriptLocation, processObj) ***REMOVED***
  // set dirname and process if not passed in
  // this facilitates regression tests
  if (scriptLocation === undefined) ***REMOVED***
    scriptLocation = __dirname
  ***REMOVED***
  if (processObj === undefined) ***REMOVED***
    processObj = process
  ***REMOVED***

  // Have a look to see what is above us, to try and work out where we are
  npm_parent_directory = path.join(scriptLocation, '../../../..')
  log.verbose('node-gyp root', 'npm_parent_directory is '
              + path.basename(npm_parent_directory))
  node_root_dir = ""

  log.verbose('node-gyp root', 'Finding node root directory')
  if (path.basename(npm_parent_directory) === 'deps') ***REMOVED***
    // We are in a build directory where this script lives in
    // deps/npm/node_modules/node-gyp/lib
    node_root_dir = path.join(npm_parent_directory, '..')
    log.verbose('node-gyp root', 'in build directory, root = '
                + node_root_dir)
  ***REMOVED*** else if (path.basename(npm_parent_directory) === 'node_modules') ***REMOVED***
    // We are in a node install directory where this script lives in
    // lib/node_modules/npm/node_modules/node-gyp/lib or
    // node_modules/npm/node_modules/node-gyp/lib depending on the
    // platform
    if (processObj.platform === 'win32') ***REMOVED***
      node_root_dir = path.join(npm_parent_directory, '..')
***REMOVED*** else ***REMOVED***
      node_root_dir = path.join(npm_parent_directory, '../..')
***REMOVED***
    log.verbose('node-gyp root', 'in install directory, root = '
                + node_root_dir)
  ***REMOVED*** else ***REMOVED***
    // We don't know where we are, try working it out from the location
    // of the node binary
    var node_dir = path.dirname(processObj.execPath)
    var directory_up = path.basename(node_dir)
    if (directory_up === 'bin') ***REMOVED***
      node_root_dir = path.join(node_dir, '..')
***REMOVED*** else if (directory_up === 'Release' || directory_up === 'Debug') ***REMOVED***
      // If we are a recently built node, and the directory structure
      // is that of a repository. If we are on Windows then we only need
      // to go one level up, everything else, two
      if (processObj.platform === 'win32') ***REMOVED***
        node_root_dir = path.join(node_dir, '..')
  ***REMOVED*** else ***REMOVED***
        node_root_dir = path.join(node_dir, '../..')
  ***REMOVED***
***REMOVED***
    // Else return the default blank, "".
  ***REMOVED***
  return node_root_dir
***REMOVED***

module.exports = findNodeDirectory
