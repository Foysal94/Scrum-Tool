/*!
 * node-sass: lib/extensions.js
 */

var flags = ***REMOVED******REMOVED***,
    fs = require('fs'),
    pkg = require('../package.json'),
    path = require('path');

/**
 * Collect Arguments
 *
 * @param ***REMOVED***Array***REMOVED*** args
 * @api private
 */

function collectArguments(args) ***REMOVED***
  for (var i = 0; i < args.length; i += 2) ***REMOVED***
    if (args[i].lastIndexOf('--', 0) !== 0) ***REMOVED***
      --i;
      continue;
***REMOVED***

    flags[args[i]] = args[i + 1];
  ***REMOVED***
***REMOVED***

/**
 * Get Runtime Info
 *
 * @api private
 */

function getRuntimeInfo() ***REMOVED***
  var execPath = fs.realpathSync(process.execPath); // resolve symbolic link

  var runtime = execPath
               .split(/[\\/]+/).pop()
               .split('.').shift();

  runtime = runtime === 'nodejs' ? 'node' : runtime;

  return ***REMOVED***
    name: runtime,
    execPath: execPath
  ***REMOVED***;
***REMOVED***

/**
 * Get binary name.
 * If environment variable SASS_BINARY_NAME,
 * .npmrc variable sass_binary_name or
 * process argument --binary-name is provided,
 * return it as is, otherwise make default binary
 * name: ***REMOVED***platform***REMOVED***-***REMOVED***arch***REMOVED***-***REMOVED***v8 version***REMOVED***.node
 *
 * @api private
 */

function getBinaryName() ***REMOVED***
  var binaryName;

  if (flags['--sass-binary-name']) ***REMOVED***
    binaryName = flags['--sass-binary-name'];
  ***REMOVED*** else if (process.env.SASS_BINARY_NAME) ***REMOVED***
    binaryName = process.env.SASS_BINARY_NAME;
  ***REMOVED*** else if (process.env.npm_config_sass_binary_name) ***REMOVED***
    binaryName = process.env.npm_config_sass_binary_name;
  ***REMOVED*** else if (pkg.nodeSassConfig && pkg.nodeSassConfig.binaryName) ***REMOVED***
    binaryName = pkg.nodeSassConfig.binaryName;
  ***REMOVED*** else ***REMOVED***
    binaryName = [process.platform, '-',
                  process.arch, '-',
                  process.versions.modules].join('');
  ***REMOVED***

  return [binaryName, 'binding.node'].join('_');
***REMOVED***

/**
 * Determine the URL to fetch binary file from.
 * By default fetch from the node-sass distribution
 * site on GitHub.
 *
 * The default URL can be overriden using
 * the environment variable SASS_BINARY_SITE,
* .npmrc variable sass_binary_site or
 * or a command line option --sass-binary-site:
 *
 *   node scripts/install.js --sass-binary-site http://example.com/
 *
 * The URL should to the mirror of the repository
 * laid out as follows:
 *
 * SASS_BINARY_SITE/
 *
 *  v3.0.0
 *  v3.0.0/freebsd-x64-14_binding.node
 *  ....
 *  v3.0.0
 *  v3.0.0/freebsd-ia32-11_binding.node
 *  v3.0.0/freebsd-x64-42_binding.node
 *  ... etc. for all supported versions and platforms
 *
 * @api private
 */

function getBinaryUrl() ***REMOVED***
  var site = flags['--sass-binary-site'] ||
             process.env.SASS_BINARY_SITE  ||
             process.env.npm_config_sass_binary_site ||
             (pkg.nodeSassConfig && pkg.nodeSassConfig.binarySite) ||
             'https://github.com/sass/node-sass/releases/download';

	return [site, 'v' + pkg.version, sass.binaryName].join('/');
***REMOVED***


collectArguments(process.argv.slice(2));

var sass = process.sass = ***REMOVED******REMOVED***;

sass.binaryName = getBinaryName();
sass.binaryUrl = getBinaryUrl();
sass.runtime = getRuntimeInfo();

/**
 * Get binary path.
 * If environment variable SASS_BINARY_PATH,
 * .npmrc variable sass_binary_path or
 * process argument --sass-binary-path is provided,
 * select it by appending binary name, otherwise
 * make default binary path using binary name.
 * Once the primary selection is made, check if
 * callers wants to throw if file not exists before
 * returning.
 *
 * @param ***REMOVED***Boolean***REMOVED*** throwIfNotExists
 * @api private
 */

sass.getBinaryPath = function(throwIfNotExists) ***REMOVED***
  var binaryPath;

  if (flags['--sass-binary-path']) ***REMOVED***
    binaryPath = flags['--sass-binary-path'];
  ***REMOVED*** else if (process.env.SASS_BINARY_PATH) ***REMOVED***
    binaryPath = process.env.SASS_BINARY_PATH;
  ***REMOVED*** else if (process.env.npm_config_sass_binary_path) ***REMOVED***
    binaryPath = process.env.npm_config_sass_binary_path;
  ***REMOVED*** else if (pkg.nodeSassConfig && pkg.nodeSassConfig.binaryPath) ***REMOVED***
    binaryPath = pkg.nodeSassConfig.binaryPath;
  ***REMOVED*** else ***REMOVED***
    binaryPath = path.join(__dirname, '..', 'vendor', sass.binaryName.replace(/_/, '/'));
  ***REMOVED***

  if (!fs.existsSync(binaryPath) && throwIfNotExists) ***REMOVED***
    throw new Error([
      ['The `libsass` binding was not found in', binaryPath].join(' '),
      ['This usually happens because your node version has changed.'],
      ['Run `npm rebuild node-sass` to build the binding for your current node version.'],
    ].join('\n'));
  ***REMOVED***

  return binaryPath;
***REMOVED***;

sass.binaryPath = sass.getBinaryPath();
